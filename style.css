// --- CONFIGURATION ---
// These are the words that will appear stacked vertically after the countdown.
const WORDS_TO_REVEAL = ["HAPPY", "BIRTHDAY", "TO", "YOU"];
const COUNTDOWN_DELAY_MS = 1500; // Time (in milliseconds) between 3, 2, and 1
const TRANSITION_DELAY_MS = 2000; // Time to show the final words before moving to the gift section

// --- DOM ELEMENTS (Must match IDs in index.html) ---
const startButton = document.getElementById('start-button');
const countdownNumberEl = document.getElementById('countdown-number');
const revealTextEl = document.getElementById('reveal-text');
const countdownSection = document.getElementById('countdown-section');
const giftSection = document.getElementById('gift-section');
const messageCard = document.getElementById('message-card');
const music = document.getElementById('background-music');

let countdownValue = 3; // Starting number for the countdown

// --- HELPER: MATRIX BACKGROUND GENERATION ---
// This creates the random, falling green characters.
function generateMatrixBackground() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890@#$%^&*()';
    const columns = Math.floor(window.innerWidth / 20);
    const container = document.body;

    for (let i = 0; i < columns; i++) {
        const column = document.createElement('div');
        column.className = 'matrix-column';
        column.style.left = `${i * 20}px`;
        
        // Create a long string of random characters for the column
        column.textContent = Array(Math.ceil(window.innerHeight / 20) + 1)
            .fill()
            .map(() => chars[Math.floor(Math.random() * chars.length)])
            .join('\n'); // \n is crucial for vertical display
        
        // Add a random delay to make the rain look random
        column.style.animationDelay = `-${Math.random() * 5}s`; 
        container.appendChild(column);
    }
}


// --- STEP 1: START SEQUENCE (Main function, called by 'START' button click) ---
// This function initializes the entire animated sequence.
window.startSequence = function() {
    // 1. Hide the start button and clear initial text
    if (startButton) startButton.classList.add('hidden');
    countdownNumberEl.innerHTML = ''; 
    
    // 2. Start Matrix and Music
    generateMatrixBackground();
    music.play().catch(e => console.log("Music auto-play blocked:", e));

    // 3. Set the first countdown number
    countdownNumberEl.innerHTML = countdownValue;
    
    const interval = setInterval(() => {
        countdownValue -= 1;
        
        if (countdownValue >= 1) {
            countdownNumberEl.innerHTML = countdownValue;
        } else if (countdownValue === 0) {
            countdownNumberEl.innerHTML = 'GO!'; 
            clearInterval(interval);
            setTimeout(revealGreeting, 500); // Wait 0.5s before revealing words
        }
    }, COUNTDOWN_DELAY_MS);
}


// --- STEP 2: REVEAL GREETING TEXT ---
function revealGreeting() {
    countdownNumberEl.classList.add('hidden');
    
    let wordIndex = 0;
    revealTextEl.innerHTML = '';
    
    const revealInterval = setInterval(() => {
        if (wordIndex < WORDS_TO_REVEAL.length) {
            // Append the next word as a separate, vertical element
            revealTextEl.innerHTML += `<span>${WORDS_TO_REVEAL[wordIndex]}</span>`;
            wordIndex++;
        } else {
            clearInterval(revealInterval);
            // Transition to the animated gift section
            setTimeout(() => {
                countdownSection.classList.add('hidden');
                giftSection.classList.remove('hidden');
            }, TRANSITION_DELAY_MS); 
        }
    }, 800); // Delay between each word appearing
}


// --- STEP 3: OPEN GIFT BUTTON ACTION (called by gift button click) ---
window.openGift = function() {
    document.getElementById('open-gift-button').classList.add('hidden');
    // Reveal the hidden card with your message image
    messageCard.classList.remove('hidden'); 
}

// --- INITIALIZE: Display the Matrix rain helper and the button immediately on load ---
document.addEventListener('DOMContentLoaded', generateMatrixBackground);
